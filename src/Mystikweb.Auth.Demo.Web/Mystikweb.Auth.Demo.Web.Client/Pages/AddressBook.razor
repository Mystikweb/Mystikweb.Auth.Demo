@page "/address-book"

@using Microsoft.AspNetCore.Authorization

@attribute [StreamRendering]
@attribute [Authorize]

@inject ILogger<AddressBook> Logger
@inject IAddressBookApiClient AddressBookApiClient

<PageTitle>Address Book</PageTitle>

<FluentDataGrid Id="addressbook-grid" Items="@addressBook" GridTemplateColumns="1fr 1fr" TGridItem="PersonItem">
    <PropertyColumn Title="First Name" Property="@(c => c!.FirstName)" Align="Align.Start" />
    <PropertyColumn Title="Last Name" Property="@(c => c!.LastName)" Align="Align.Start" />
</FluentDataGrid>

@code {
    private IQueryable<PersonItem>? addressBook;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            addressBook = (await AddressBookApiClient.GetPeopleAsync()).AsQueryable();
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Failed to load address book");
            addressBook = Enumerable.Empty<PersonItem>().AsQueryable();
        }
    }

}
